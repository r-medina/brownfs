#!/bin/bash

set -e

SCRIPT_HOME=$( cd "$( dirname "$0" )" && pwd )

cd "${SCRIPT_HOME}"/..

function get_uname {
    [[ -a .uname ]] && uname=$(cat .uname)
    echo ${uname}
}

function init {
    [[ $# -eq 0 ]] && echo "usage: $0 init USERNAME" && return 1;

    uname=$1
    echo $1 > .uname
}

function mount_files {
    uname=$(get_uname)
    [[ -z ${uname} ]] && echo "run: $0 init USERNAME" && return 1;

    mkdir -p home/${uname}
    sshfs ${uname}@brown:/gpfs/main/home/${uname} home/${uname}

    mkdir -p course
    sshfs ${uname}@brown:/gpfs/main/course course
}

function umount_files {
    uname=$(get_uname)
    [[ -z ${uname} ]] && echo "run: $0 init USERNAME" && return 1;

    set +e
    umount home/${uname} # && rm -r home
    umount course # && rm -r course
    set -e
}

case "$1" in
    init)
        init ${@:2}
        ;;
    mount)
        mount_files ${@:2}
        ;;
    umount)
        umount_files ${@:2}
        ;;
    *)
        echo "usage: $0 {}"
        RETVAL=1
        ;;
esac

cd - > /dev/null
